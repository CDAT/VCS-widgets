{"version":3,"sources":["../../src/common/NumberField.jsx"],"names":["parseNum","v","indexOf","parts","split","main","parseFloat","exp","parseInt","Math","pow","shouldExponentiate","isNaN","isFinite","absval","abs","frac","floor","log10","numregexp","NumberField","props","state","validationState","value","update","bind","validate","nextProps","setState","e","new_val","target","exponential","autoround","updatedValue","step","new_state","test","minValue","maxValue","label","controlId","placeholder","help","numval","unsigned","rest","style","display","inline","propTypes","number","maxvalue","func","string","bool","defaultProps"],"mappings":"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","file":"NumberField.js","sourcesContent":["import React, { Component } from 'react' \nimport PropTypes from 'prop-types'\nimport {FormControl, FormGroup, ControlLabel, HelpBlock} from 'react-bootstrap'\n\n\nfunction parseNum(v) {\n    if (typeof v === \"string\") {\n        if (v.indexOf(\"e\") != -1) {\n            let parts = v.split(\"e\");\n            const main = parseFloat(parts[0]);\n            const exp = parseInt(parts[1]);\n            v = Math.pow(10, exp) * main;\n        } else {\n            v = parseFloat(v);\n        }\n    }\n    return v;\n}\n\nfunction shouldExponentiate(v) {\n    if (isNaN(v) || !isFinite(v)) {\n        return false;\n    }\n    let absval = Math.abs(v);\n    if (absval >= 1e10) {\n        return true;\n    }\n    if (v === 0) {\n        // will break logarithms; also, not needed.\n        return false;\n    }\n\n    let frac = absval - Math.floor(absval)\n    if (frac === 0) {\n        return false;\n    }\n    if (Math.log10(frac) < -10) {\n        return true;\n    }\n\n    return false;\n}\n\nconst numregexp = /-?\\d*\\.\\d*(e\\d+)?/\n\n\nclass NumberField extends Component {\n    constructor(props){\n        super(props)\n        this.state = {\n            validationState: null,\n            value: props.value\n        }\n        this.update = this.update.bind(this)\n        this.validate = this.validate.bind(this)\n    }\n    \n    componentWillReceiveProps(nextProps) {\n        this.setState({\"value\": nextProps.value, \"validationState\": null});\n    }\n\n    update(e) {\n        let new_val = e.target.value;\n        if (this.props.exponential) {\n            new_val = parseNum(new_val);\n        }\n        if (new_val !== this.props.value) {\n            if (this.props.autoround) {\n                this.props.updatedValue(Math.floor(new_val / this.props.step) * this.props.step);\n            } else {\n                this.props.updatedValue(new_val);\n            }\n        }\n    }\n\n    validate(e) {\n        let new_val = e.target.value;\n\n        const new_state = {\n            \"value\": e.target.value, //Use the provided value, just make sure it's valid.\n            \"validationState\": \"success\"\n        };\n\n        if (!numregexp.test(new_val)) {\n            // Invalid number\n            new_state.validationState  = \"error\";\n        }\n\n        // Check value limits\n        new_val = parseNum(new_val);\n\n        if (this.props.minValue !== null && new_val < this.props.minValue) {\n            new_state.validationState = \"error\";\n        }\n        if (this.props.maxValue !== null && new_val > this.props.maxValue) {\n            new_state.validationState = \"error\";\n        }\n        this.setState(new_state);\n    }\n\n    render() {\n        let {minValue, step, maxValue, label, controlId, placeholder} = this.props;\n\n        let value = this.state.value;\n\n        let help = '';\n        if (this.state.validationState === \"warning\" || this.state.validationState === \"error\") {\n            help = <HelpBlock>Value must be between a valid number {minValue === null ? \"greater than \" + minValue : \"\"} {minValue !== null && maxValue !== null ? \" and \" : \"\"} {maxValue !== null ? \" less than \" + maxValue : \"\"}</HelpBlock>\n        }\n        if (value === null) {\n            value = \"\";\n        }\n        const numval = parseNum(value);\n        if (this.props.exponential && shouldExponentiate(numval)) {\n            let unsigned = Math.abs(numval);\n            let exp = Math.floor(Math.log10(unsigned));\n            let rest = numval / Math.pow(10, exp);\n            value = rest + \"e\" + exp;\n        }\n        const style = {\n            display: this.props.inline ? \"inline-block\" : \"block\"\n        }\n        return (\n            <FormGroup style={style} controlId={controlId}>\n                {label ? <ControlLabel>{label}</ControlLabel> : ''}\n                <FormControl placeholder={placeholder} onChange={this.validate} onBlur={this.update} value={value} />\n                {help}\n            </FormGroup>\n        );\n    }\n}\n\nNumberField.propTypes = { \n    value: PropTypes.number,\n    minValue: PropTypes.number,\n    maxvalue: PropTypes.number,\n    updatedValue: PropTypes.func,\n    label: PropTypes.string,\n    controlId: PropTypes.string,\n    step: PropTypes.number,\n    autoround: PropTypes.bool,\n    placeholder: PropTypes.string,\n    exponential: PropTypes.bool,\n    inline: PropTypes.bool\n}\n\nNumberField.defaultProps = {\n    inline: false,\n    minValue: 0,\n    maxValue: 100,\n    step: 1,\n    autoround: false,\n    placeholder: \"\",\n    exponential: true\n}\n\nexport default NumberField;\n"]}